{"ast":null,"code":"import _asyncToGenerator from\"/Users/mehulchattopadhyay/Desktop/amazon-clone/amazon/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/mehulchattopadhyay/Desktop/amazon-clone/amazon/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/mehulchattopadhyay/Desktop/amazon-clone/amazon/node_modules/@babel/runtime/regenerator/index.js\";import{ListItem}from\"@mui/material\";import React,{useState,useEffect}from\"react\";import{auth}from\"../Firebase\";import{useStateValue}from\"../StateProvider\";import CheckoutProduct from\"./CheckoutProduct\";import Product from\"./Product\";import{Link,useHistory}from\"react-router-dom\";import\"./Payment.css\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import CurrencyFormat from\"react-currency-format\";import axios from\"axios\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function Payment(){var currentUser=auth.currentUser;var history=useHistory();var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),error=_useState2[0],setError=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),succeeded=_useState6[0],setSucceeded=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),processing=_useState8[0],setProcessing=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),client=_useState10[0],setClient=_useState10[1];var stripe=useStripe();var elements=useElements();function handleSubmit(_x){return _handleSubmit.apply(this,arguments);}function _handleSubmit(){_handleSubmit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(client,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref){var paymentIntent=Object.assign({},_ref);setSucceeded(true);setError(null);setProcessing(false);history.replace(\"/orders\");});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return _handleSubmit.apply(this,arguments);}function handleChange(event){setDisabled(event.empty);setError(event.error?event.error.message:\"\");}var total=0;basket.map(function(item){total+=item.price;});useEffect(function(){function getClient(){return _getClient.apply(this,arguments);}function _getClient(){_getClient=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:\"post\",url:\"/payments/create?total=\".concat(total*100)});case 2:response=_context.sent;setClient(response.data.client);case 4:case\"end\":return _context.stop();}}},_callee);}));return _getClient.apply(this,arguments);}getClient();},[basket]);return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment-container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout ( \",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[\" \",basket===null||basket===void 0?void 0:basket.length,\" items \"]}),\" )\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment-title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Details\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-address\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:currentUser.email})}),/*#__PURE__*/_jsx(\"p\",{children:\"221B Baker Street\"}),/*#__PURE__*/_jsx(\"p\",{children:\"London, England\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment-title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review Items\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{title:item.title,id:item.id,image:item.image,rating:item.rating,price:item.price});})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment-title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment-details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-price-container\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Order Total : \"}),/*#__PURE__*/_jsx(\"strong\",{children:value})]}),/*#__PURE__*/_jsxs(\"small\",{className:\"subtotal-gift\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\"}),\" This order contains a gift\"]})]});},decimalScale:2,value:total,displayType:\"text\",thousandSeparator:true,prefix:\"$\"}),/*#__PURE__*/_jsx(\"button\",{className:\"payment\",type:\"submit\",disabled:disabled||succeeded||processing,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})]})});}export default Payment;","map":{"version":3,"sources":["/Users/mehulchattopadhyay/Desktop/amazon-clone/amazon/src/Components/Payment.js"],"names":["ListItem","React","useState","useEffect","auth","useStateValue","CheckoutProduct","Product","Link","useHistory","CardElement","useStripe","useElements","CurrencyFormat","axios","Payment","currentUser","history","basket","user","dispatch","error","setError","disabled","setDisabled","succeeded","setSucceeded","processing","setProcessing","client","setClient","stripe","elements","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","replace","payload","handleChange","empty","message","total","map","item","price","getClient","method","url","response","data","length","email","title","id","image","rating","value"],"mappings":"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","sourcesContent":["import { ListItem } from \"@mui/material\";\nimport React, { useState, useEffect } from \"react\";\nimport { auth } from \"../Firebase\";\nimport { useStateValue } from \"../StateProvider\";\nimport CheckoutProduct from \"./CheckoutProduct\";\nimport Product from \"./Product\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport \"./Payment.css\";\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport CurrencyFormat from \"react-currency-format\";\nimport axios from \"axios\";\n\nfunction Payment() {\n  const currentUser = auth.currentUser;\n  const history = useHistory();\n  const [{ basket, user }, dispatch] = useStateValue();\n  const [error, setError] = useState(null);\n  const [disabled, setDisabled] = useState(true);\n  const [succeeded, setSucceeded] = useState(false);\n  const [processing, setProcessing] = useState(\"\");\n  const [client, setClient] = useState(true);\n  const stripe = useStripe();\n  const elements = useElements();\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n    setProcessing(true);\n    const payload = await stripe\n      .confirmCardPayment(client, {\n        payment_method: {\n          card: elements.getElement(CardElement),\n        },\n      })\n      .then(({ ...paymentIntent }) => {\n        setSucceeded(true);\n        setError(null);\n        setProcessing(false);\n        history.replace(\"/orders\");\n      });\n  }\n\n  function handleChange(event) {\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  }\n\n  var total = 0;\n  basket.map((item) => {\n    total += item.price;\n  });\n\n  useEffect(() => {\n    async function getClient() {\n      const response = await axios({\n        method: \"post\",\n        url: `/payments/create?total=${total * 100}`,\n      });\n      setClient(response.data.client);\n    }\n    getClient();\n  }, [basket]);\n\n  return (\n    <div className=\"payment\">\n      <div className=\"payment-container\">\n        <h1>\n          Checkout ( <Link to=\"/checkout\"> {basket?.length} items </Link> )\n        </h1>\n        <div className=\"payment-section\">\n          <div className=\"payment-title\">\n            <h3>Delivery Details</h3>\n          </div>\n          <div className=\"payment-address\">\n            <p>\n              <strong>{currentUser.email}</strong>\n            </p>\n            <p>221B Baker Street</p>\n            <p>London, England</p>\n          </div>\n        </div>\n        <div className=\"payment-section\">\n          <div className=\"payment-title\">\n            <h3>Review Items</h3>\n          </div>\n\n          <div className=\"payment-items\">\n            {basket.map((item) => (\n              <CheckoutProduct\n                title={item.title}\n                id={item.id}\n                image={item.image}\n                rating={item.rating}\n                price={item.price}\n              />\n            ))}\n          </div>\n        </div>\n        <div className=\"payment-section\">\n          <div className=\"payment-title\">\n            <h3>Payment Method</h3>\n          </div>\n          <div className=\"payment-details\">\n            <form onSubmit={handleSubmit}>\n              <CardElement onChange={handleChange} />\n              <div className=\"payment-price-container\">\n                <CurrencyFormat\n                  renderText={(value) => (\n                    <>\n                      <p>\n                        <strong>Order Total : </strong>\n                        <strong>{value}</strong>\n                      </p>\n                      <small className=\"subtotal-gift\">\n                        <input type=\"checkbox\" /> This order contains a gift\n                      </small>\n                    </>\n                  )}\n                  decimalScale={2}\n                  value={total}\n                  displayType={\"text\"}\n                  thousandSeparator={true}\n                  prefix={\"$\"}\n                />\n                <button\n                  className=\"payment\"\n                  type=\"submit\"\n                  disabled={disabled || succeeded || processing}\n                >\n                  <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\n                </button>\n              </div>\n              {error && <div>{error}</div>}\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Payment;\n"]},"metadata":{},"sourceType":"module"}